<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>更新学生信息</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .input-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    .alert {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      border-radius: 5px;
      display: none;
      transition: opacity 0.5s ease;
    }
    .alert.show {
      display: block;
      opacity: 1;
    }
    .alert.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>更新学生信息</h1>
    
    <div class="input-group">
      <label for="student-id">学号</label>
      <input type="text" id="student-id" placeholder="请输入学号" required>
    </div>
    
    <div class="input-group">
      <label for="wechat">微信</label>
      <input type="text" id="wechat" placeholder="请输入微信号" required>
    </div>
    
    <button id="update-btn">确认更新</button>
    
    <div class="alert" id="alert-box">
      更新失败，请检查输入或网络连接。
    </div>
  </div>

  <script>
    document.getElementById("update-btn").addEventListener("click", async function() {
      const studentIdInput = document.getElementById("student-id");
      const wechatInput = document.getElementById("wechat");
      const updateBtn = document.getElementById("update-btn");
      
      const studentId = studentIdInput.value.trim();
      const wechat = wechatInput.value.trim();
      
      // 清除之前的警告
      hideAlert();

      // 输入验证
      if (!studentId || !wechat) {
        showAlert("学号和微信不能为空！", "error");
        return;
      }

      // 示例：学号必须为数字
      if (!/^\d+$/.test(studentId)) {
        showAlert("学号必须为数字！", "error");
        return;
      }

      // 示例：微信号格式验证（根据实际需求调整）
      if (!/^[a-zA-Z0-9_-]{5,20}$/.test(wechat)) {
        showAlert("微信号格式不正确！", "error");
        return;
      }

      // 禁用按钮防止重复提交
      updateBtn.disabled = true;
      updateBtn.textContent = "更新中...";

      try {
        // 获取之前的数据
        const previousResponse = await fetch('https://textdb.online/qewhfjkeshfsdhfkjsdfhkjds');
        if (!previousResponse.ok) {
          throw new Error("获取数据失败");
        }
        const previousData = await previousResponse.text();
        console.log("之前的数据:", previousData);
        
        // 叠加新的学号和微信
        const newData = previousData ? `${previousData};${studentId};${wechat}` : `${studentId};${wechat}`;
        console.log("新的数据:", newData);

        // 更新数据到 API
        const updateUrl = `https://api.textdb.online/update/?key=qewhfjkeshfsdhfkjsdfhkjds&value=${encodeURIComponent(newData)}`;
        const updateResponse = await fetch(updateUrl, {
          method: 'POST', // 改为 POST 请求
          headers: {
            'Content-Type': 'application/json' // 根据 API 需求调整
          },
          body: JSON.stringify({ value: newData }) // 根据 API 需求调整
        });

        if (!updateResponse.ok) {
          throw new Error("更新请求失败");
        }

        const data = await updateResponse.json();
        console.log("API 返回的数据:", data);
        
        if (data.status === 1) {
          showAlert("更新成功！数据已保存。", "success");
          // 清空输入框
          studentIdInput.value = '';
          wechatInput.value = '';
        } else {
          showAlert("更新失败，请稍后重试。", "error");
        }
      } catch (error) {
        console.error("操作失败", error);
        showAlert("操作失败，请检查网络连接。", "error");
      } finally {
        // 恢复按钮状态
        updateBtn.disabled = false;
        updateBtn.textContent = "确认更新";
      }
    });

    function showAlert(message, type) {
      const alertBox = document.getElementById("alert-box");
      alertBox.textContent = message;
      alertBox.className = "alert"; // 重置类名
      if (type === "success") {
        alertBox.classList.add("success");
      }
      alertBox.classList.add("show");

      // 自动隐藏警告框 after 5 seconds
      setTimeout(hideAlert, 5000);
    }

    function hideAlert() {
      const alertBox = document.getElementById("alert-box");
      alertBox.classList.remove("show");
    }
  </script>

</body>
</html>